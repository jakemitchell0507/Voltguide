<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VoltGuide Pro v11</title>

<!-- jsPDF for real PDF certificates -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #0f172a;
  color: white;
  text-align: center;
}

header {
  background: #020617;
  padding: 15px;
}

button {
  display: block;
  margin: 10px auto;
  padding: 12px;
  width: 80%;
  max-width: 320px;
  border: none;
  border-radius: 10px;
  background: #2563eb;
  color: white;
  font-size: 16px;
  cursor: pointer;
}

input, select {
  width: 80%;
  max-width: 320px;
  padding: 10px;
  margin: 8px auto;
  display: block;
  border-radius: 8px;
  border: none;
}

.screen { display: none; }
.screen.active { display: block; }

ul { list-style: none; padding: 0; }
li { margin: 8px 0; }
</style>
</head>

<body>

<header>
<h1>⚡ VoltGuide Pro v11</h1>
</header>

<main>

<!-- HOME -->
<section id="home" class="screen active">
<button onclick="showScreen('voltage')">Voltage Drop</button>
<button onclick="showScreen('fault')">Distance to Fault</button>
<button onclick="showScreen('zs')">Max Zs Lookup</button>
<button onclick="showScreen('certificate')">Generate EIC PDF</button>
<button onclick="showScreen('history')">Saved Results</button>
</section>

<!-- VOLTAGE DROP -->
<section id="voltage" class="screen">
<h2>Voltage Drop Calculator</h2>

<select id="cable">
<option value="1.5">1.5 mm²</option>
<option value="2.5">2.5 mm²</option>
<option value="4">4 mm²</option>
<option value="6">6 mm²</option>
</select>

<input id="length" type="number" placeholder="Length (m)">
<input id="current" type="number" placeholder="Current (A)">

<button onclick="calcVoltage()">Calculate</button>
<p id="voltageResult"></p>

<button onclick="saveResult('Voltage Drop', voltageResult.textContent)">Save</button>
<button onclick="showScreen('home')">Back</button>
</section>

<!-- FAULT -->
<section id="fault" class="screen">
<h2>Distance to Fault</h2>

<input id="faultDrop" type="number" placeholder="Measured Voltage Drop (V)">
<input id="faultRes" type="number" step="0.001" placeholder="Cable Resistance (Ω/m)">

<button onclick="calcFault()">Calculate</button>
<p id="faultResult"></p>

<button onclick="saveResult('Fault Distance', faultResult.textContent)">Save</button>
<button onclick="showScreen('home')">Back</button>
</section>

<!-- ZS -->
<section id="zs" class="screen">
<h2>Max Zs Lookup</h2>

<select id="breakerType">
<option value="B">Type B</option>
<option value="C">Type C</option>
<option value="D">Type D</option>
</select>

<select id="breakerRating">
<option>6</option><option>10</option><option>16</option>
<option>20</option><option>32</option><option>40</option>
<option>50</option><option>63</option>
</select>

<button onclick="calcZs()">Lookup</button>
<p id="zsResult"></p>

<button onclick="saveResult('Max Zs', zsResult.textContent)">Save</button>
<button onclick="showScreen('home')">Back</button>
</section>

<!-- CERTIFICATE -->
<section id="certificate" class="screen">
<h2>Electrical Installation Certificate (EIC)</h2>

<input id="clientName" placeholder="Client Name">
<input id="clientAddress" placeholder="Address">
<input id="circuit" placeholder="Circuit Description">
<input id="result" placeholder="Test Result">

<button onclick="downloadCertificate()">Download EIC PDF</button>
<button onclick="showScreen('home')">Back</button>
</section>

<!-- HISTORY -->
<section id="history" class="screen">
<h2>Saved Results</h2>
<ul id="historyList"></ul>

<button onclick="clearHistory()">Clear All</button>
<button onclick="showScreen('home')">Back</button>
</section>

</main>

<script>
function showScreen(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  if (id === "history") loadHistory();
}

/* Voltage Drop */
function calcVoltage() {
  const cable = parseFloat(document.getElementById("cable").value);
  const length = parseFloat(document.getElementById("length").value);
  const current = parseFloat(document.getElementById("current").value);

  const map = {1.5:0.0121, 2.5:0.00741, 4:0.00461, 6:0.00308};
  if (!length || !current) return;

  const vd = map[cable] * length * current;

  document.getElementById("voltageResult").textContent =
    "Voltage Drop: " + vd.toFixed(2) + " V";
}

/* Fault Distance */
function calcFault() {
  const drop = parseFloat(document.getElementById("faultDrop").value);
  const res = parseFloat(document.getElementById("faultRes").value);
  if (!drop || !res) return;

  document.getElementById("faultResult").textContent =
    "Estimated Distance: " + (drop / res).toFixed(1) + " m";
}

/* Max Zs */
function calcZs() {
  const type = document.getElementById("breakerType").value;
  const rating = document.getElementById("breakerRating").value;

  const table = {
    B:{6:7.67,10:4.6,16:2.87,20:2.3,32:1.44,40:1.15,50:0.92,63:0.73},
    C:{6:3.83,10:2.3,16:1.44,20:1.15,32:0.72,40:0.58,50:0.46,63:0.37},
    D:{6:1.92,10:1.15,16:0.72,20:0.58,32:0.36,40:0.29,50:0.23,63:0.18}
  };

  document.getElementById("zsResult").textContent =
    "Max Zs: " + table[type][rating] + " Ω";
}

/* Save History */
function saveResult(type, text) {
  if (!text) return;
  const data = JSON.parse(localStorage.getItem("voltguide") || "[]");
  data.push(type + ": " + text);
  localStorage.setItem("voltguide", JSON.stringify(data));
}

function loadHistory() {
  const list = document.getElementById("historyList");
  list.innerHTML = "";
  const data = JSON.parse(localStorage.getItem("voltguide") || "[]");

  data.forEach(item => {
    const li = document.createElement("li");
    li.textContent = item;
    list.appendChild(li);
  });
}

function clearHistory() {
  localStorage.removeItem("voltguide");
  loadHistory();
}

/* REAL EIC PDF */
async function downloadCertificate() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const name = document.getElementById("clientName").value;
  const address = document.getElementById("clientAddress").value;
  const circuit = document.getElementById("circuit").value;
  const result = document.getElementById("result").value;

  doc.setFontSize(18);
  doc.text("Electrical Installation Certificate (EIC)", 20, 20);

  doc.setFontSize(12);
  doc.text("Client Name: " + name, 20, 40);
  doc.text("Address: " + address, 20, 50);

  doc.text("Circuit: " + circuit, 20, 70);
  doc.text("Test Result: " + result, 20, 80);

  doc.text("Generated by VoltGuide Pro", 20, 110);
  doc.text(new Date().toLocaleDateString(), 150, 110);

  doc.save("EIC-Certificate.pdf");
}
</script>

</body>
</html>
